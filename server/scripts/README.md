# 用户数据导入工具

## 功能说明

此工具用于从Excel文件（.xlsx格式）批量导入用户数据到MySQL数据库。

## Excel文件格式要求

Excel文件的第一行应为表头（列名），支持以下列名（不区分大小写）：

### 必填字段
- **工号** (work_id, WorkID, workId) - 用户的工号，必须唯一
- **姓名** (name, Name, 用户名, user_name) - 用户姓名

### 可选字段
- **部门** (department, Department, 所属部门, dept) - 用户所属部门
- **职位** (position, Position, 职务, 职称) - 用户职位
- **密码** (password, Password, pwd) - 用户密码
- **身份证号** (id_card, IDCard, 身份证, 身份证号码) - 如果提供了身份证号但没有密码，将使用身份证号后六位作为密码

## Excel文件示例

| 工号 | 姓名 | 部门 | 职位 | 身份证号 |
|------|------|------|------|----------|
| 001  | 张三 | 技术部 | 高级工程师 | 420123199001011234 |
| 002  | 李四 | 市场部 | 市场经理 | 420123199002021234 |
| 003  | 王五 | 人事部 | 人事专员 | 420123199003031234 |

## 使用方法

### 方法一：使用npm脚本

```bash
npm run import:users <Excel文件路径>
```

示例：
```bash
npm run import:users data/users.xlsx
```

### 方法二：直接运行Node脚本

```bash
node server/scripts/importUsers.js <Excel文件路径>
```

示例：
```bash
node server/scripts/importUsers.js data/users.xlsx
```

## 导入规则

1. **数据验证**：工号和姓名为必填字段，缺少任一字段的记录将被跳过
2. **重复处理**：如果工号已存在，将更新该用户的姓名、部门、职位和密码
3. **密码处理**：
   - 如果Excel中有密码字段，使用Excel中的密码
   - 如果Excel中有身份证号但没有密码，使用身份证号后六位作为密码
   - 如果都没有，使用默认密码 '123456'
4. **错误处理**：导入过程中会显示详细的错误信息，包括失败的行号和原因

## 导入结果

导入完成后会显示：
- 成功导入的记录数
- 失败的记录数
- 总记录数

## 注意事项

1. 确保数据库已创建并配置正确（检查 `server/.env` 文件）
2. 确保Excel文件格式正确，第一行为表头
3. 工号必须唯一，重复的工号会更新现有记录
4. 建议在导入前备份数据库
5. 大量数据导入时，请耐心等待

## 常见问题

**Q: 导入时提示"数据库连接失败"**
A: 检查 `server/.env` 文件中的数据库配置是否正确，确保MySQL服务已启动。

**Q: 某些记录导入失败**
A: 检查Excel文件中该行的数据是否完整，工号和姓名是否为必填。

**Q: 密码不正确**
A: 如果Excel中没有密码字段，系统会使用身份证号后六位。如果没有身份证号，会使用默认密码'123456'。

